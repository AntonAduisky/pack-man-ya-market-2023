# Разработка ML-модуля для веб-сервиса по подбору правильной упаковки заказа

**Отрасль и направления деятельности компании**: маркетплейс, сервис для покупки товаров.

**Пользователь приложения**: работник склада (упаковщик)

**Общее описание задачи:**

- Для того, чтобы пользователь получил заказ, необходимо упаковать заказанные товары в посылки конечному клиенту. Компания заметила, что сотрудник тратит большое количество времени для выбора упаковочного материала в который необходимо упаковать товары. Существует большое количество упаковочного материала (коробочки, пакетики). </br>Необходимо придумать способ подсказывать пользователю информацию о выборе упаковочного материала. Интерфейс упаковщика должен отображать содержимое заказа для контроля комплектности. Интерфейс упаковщика должен на основании содержимого заказа, подсказывать упаковщику в какую тару (коробку, пакет, с учетом размера) нужно упаковать заказ. </br>При определении варианта упаковки (тары) для заказа нужно учитывать тип товара, весогабаритные характеристики и необходимость в дополнительной упаковке для хрупких товаров.

**Цели сервиса:**

- С высокой точностью рекомендовать правильную упаковку для заказа, которая позволит доставить товары без порчи клиенту и минимизирует затраты на упаковочный материал;
- Отображение статистики о работе модели
- Интерфейс о том, как советовать информацию по выбору коробки пользователю.

****

## Команда DS разработки

- Ильичёв Иван: https://github.com/IvanDmitrich
- Дмитрий Кин: https://github.com/dmitkin
- Валов Валерий: https://github.com/valov-vo

### Cтек

- python, pandas, matplotlib, sklearn, optuna, catboost, tqdm, py3dbp, Docker 

### Концепция разработки ML-модуля

Принято решение построить модель состоящую из трех блоков: 

- фильтрация: 100% рекомендация NONPACK/STRETCH товарам с 340 и 360 карготипом
- ML: остальные товары попадают в модель машинного обучения, которая рекомендует тип упаковки (M, N, Y)
- оптимизация: на основе выбранного типа подбирается конкретная упаковка/несколько упаковок с задачей минимизировать их количество (согласно ТЗ)

**Фильтрация** реализована с помощью условной конструкции

Для **блока с ML** был определен бэйзлайн по рекомендациям старой модели: f1_macro = 0,54 (на основе трёх классов).</br>Была построена модель на основе CatBoostClassifier, для которой были подобраны гиперпараметры с помощью Optuna. Сама модель с этими параметрами сохранена в файл. 

**Бейзлайн уверенно побит: f1_macro = 0,74 (на основе трёх классов)**

**Модель оптимизации**
<br>Логика модели:
- получает из предсказательной модели данные по наиболее вероятному классу (пакет, коробка, без упаковки/пленка)
- в рамках наиболее вероятного класса перебирает все возможные типы упаковок, считает сколько в них может поместиться товаров и считает совокупную стоимость упаковки
- выдает наиболее дешевые варианты на рассмотрение
- можно отдельно задать рекомендацию нескольких классов и нескольких вариантов в рамках одного класса

**Оценка бизнес метрики**
* В качестве бизнес-метрики выбрали стоимость упаковки заказа
* Модель экономит за счет того, что чаще предлагает товары не запаковывать (для тех товаров, которые можно не запаковывать), либо оборачивать в пупырку
* Наибольшая экономия на заказах, состоящих из большого числа товаров. Логично, т.к. чем больше товаров, тем сложнее упаковщику самостоятельно подобрать наилучший вариант
* **Модель экономит до 31% от текущих затрат**
****
**Статус проекта: завершен**
# Описание проекта

**Отрасль и направления деятельности компании**: Маркетплейс, сервис для покупки товаров.

**Общее описание задачи:**

- Для того, чтобы пользователь получил заказ, необходимо упаковать заказанные товары в посылки конечному клиенту. Компания заметила, что сотрудник тратит большое количество времени для выбора упаковочного материала в который необходимо упаковать товары. Существует большое количество упаковочного материала (коробочки, пакетики). Необходимо придумать способ подсказывать пользователю информацию о выборе упаковочного материала. Интерфейс упаковщика должен отображать содержимое заказа для контроля комплектности. Интерфейс упаковщика должен на основании содержимого заказа, подсказывать упаковщику в какую тару (коробку, пакет, с учетом размера) нужно упаковать заказ. При определении варианта упаковки (тары) для заказа нужно учитывать тип товара, весогабаритные характеристики и необходимость в дополнительной упаковке для хрупких товаров.

**Цели сервиса:**

- С высокой точностью рекомендовать правильную упаковку для заказа, которая позволит доставить товары без порчи клиенту и минимизирует затраты на упаковочный материал;
- Отображение статистики о работе модели
- Интерфейс о том, как советовать информацию по выбору коробки пользователю.

## Cтек

- python, pandas, matplotlib, optuna, catboost, Docker

## Этапы работы и выводы

**Итоги знакомства с данными**

- Данные достаточно чистенькие: нашли пару пропусков, непитоничные названия и необходимость группировки данных в data - дубликаты в этом датафрейме обозначают количество конкретного товара в заказе и столбцы, дублирующие информацию, которые удалим

**Итоги анализа исходных данных**

- Медианное значение объёма выбранной коробки в 8 раз больше медианного значения объёма товара. Думаю, это связано с тем, что коробка часто выбиралась под весь заказ, а не под один товар.
- Подавляющее большинство товаров меньше килограмма (если в таблице именно эти единицы измерения). Думаю, что вес не очень значим для выбора упаковки.
- Интересно, что максимальный размер товара 6554. Медианные значения размеров товаров 18, 8 и 15. Медианные значения линейных размеров коробки 40, 29, 15. Видим, что по медиане коробки прилично больше. Значит для большинства товаров должна найтись подходящая
- Наиболее популярный карготип 290 - Склад МГТ (малогабаритный товар)
- карготипы 340 и 360 сразу говорят нам, как упаковывать - без упаковки и стретч-плёнка соответственно. Предполагаю, что товарам с такими карготипами можно присваивать тип упаковки и без модели машинного обучения.

**Итоги анализа витрины**

- Если научимся упаковывать заказы до 3 уникальных sku по коробкам/пакетам охватим 95% заказов. 
- Наиболее популярные у упаковщиков материалы - это MYB и MYC. Это малогабаритные пакеты
- Несколько товаров тоже могут быть упакованы в стретч или неупакованы. Можем на основании карготипа присваивать таким заказам функцией фильтрации. В машинное обучение товары с этими карготипами не пойдут.
- После удаления заказов с такими карготипами в выборке всё равно остались выборы NONPACK или STRETCH, которые будем считать особыми случаями, которым неплохо бы обучить ML-модель

**Описание выбранной концепции**

Принято решение построить модель состоящую из трех блоков: 

- фильтрация: 100% рекомендация NONPACK/STRETCH товарам с 340 и 360 карготипом
- ML: остальные товары попадают в модель машинного обучения, которая рекомендует тип упаковки (M, N, Y)
- оптимизация: на основе выбранного типа подбирается конкретная упаковка/несколько упаковок с задачей минимизировать их количество (согласно ТЗ)

**Фильтрация** реализована с помощью условной конструкции

Для **блока с ML** был определен бэйзлайн по рекомендациям старой модели: f1_macro = 0,54 (на основе трёх классов)
Была построена модель на основе CatBoostClassifier, для которой были подобраны гиперпараметры с помощью Optuna. Сама модель с этими параметрами сохранена в файл. **Бейзлайн уверенно побит: f1_macro = 0,74 (на основе трёх классов)**

**Модель оптимизации**
<br>Логика модели:
- получает из предсказательной модели данные по наиболее вероятному классу (пакет, коробка, без упаковки/пленка)
- в рамках наиболее вероятного класса перебирает все возможные типы упаковок, считает сколько в них может поместиться товаров и считает совокупную стоимость упаковки
- выдает наиболее дешевые варианты на рассмотрение
- можно отдельно задать рекомендацию нескольких классов и нескольких вариантов в рамках одного класса

**Оценка бизнес метрики**
* В качестве бизнес-метрики выбрали стоимость упаковки заказа
* Модель экономит за счет того, что чаще предлагает товары не запаковывать (для тех товаров, которые можно не запаковывать), либо оборачивать в пупырку
* Наибольшая экономия на заказах, состоящих из большого числа товаров. Логично, т.к. чем больше товаров, тем сложнее упаковщику самостоятельно подобрать наилучший вариант
* Модель экономит до 35% от текущих затрат